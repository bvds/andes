!function(e){var t=e.Ext;"undefined"==typeof t&&(e.Ext=t={}),t.define=function(t,n){var s,i,a,o,c=function(){return this.constructor&&this.constructor.apply(this,arguments)},r=c.prototype,l=e,u=t.split("."),h=u.length-1,f=u[h],d=n.extend;d&&(delete n.extend,c.prototype=r=Object.create(d.prototype),r.superclass=d.prototype);for(s in n)n.hasOwnProperty(s)&&(i=n[s],r[s]=i);for(n.singleton&&(c=new c),o=0;h>o;o++)a=u[o],l=l[a]||(l[a]={});return l[f]=i,c};var n=window.navigator.userAgent.match(/SenchaSpace\/([0-9\.]+)/),s=[];n&&(t.isSpace=!0,t.spaceVersion=n[1]),t.isSpaceReady=!1,t.onSpaceReady=function(e,n){t.isSpace&&(t.isSpaceReady?e.call(n):s.push(arguments))},t.setSpaceReady=function(){for(var e,t=s.length,n=0;t>n;n++)e=s[n],e[0].call(e[1]);s.length=0}}(this),Ext.define("Ext.space.Communicator",{singleton:!0,SERVER_URL:"http://127.0.0.1:3000",callbackDataMap:{},callbackIdMap:{},idSeed:0,globalScopeId:"0",init:function(e){this.appId=e,Ext.setSpaceReady()},generateId:function(){return String(++this.idSeed)},getId:function(e){var t=e.$callbackId;return t||(e.$callbackId=t=this.generateId()),t},getCallbackId:function(e,t){var n,s,i,a,o=this.callbackIdMap,c=this.callbackDataMap;return s=t?t.isIdentifiable?t.getId():this.getId(t):this.globalScopeId,i=this.getId(e),o[s]||(o[s]={}),o[s][i]||(n=this.generateId(),a={callback:e,scope:t},o[s][i]=n,c[n]=a),o[s][i]},getCallbackData:function(e){return this.callbackDataMap[e]},invoke:function(e,t){var n=this.getCallbackData(e);n.callback.apply(n.scope,t)},send:function(e,t){var n,s,i,a,o;if(e){if(e.callbacks){n=e.callbacks,s=e.scope,delete e.callbacks,delete e.scope;for(i in n)n.hasOwnProperty(i)&&(a=n[i],"function"==typeof a&&(e[i]=this.getCallbackId(a,s)))}}else e={};var c=new XMLHttpRequest;return c.open("POST",this.SERVER_URL+"?_dc="+(new Date).getTime(),!t),c.setRequestHeader("Content-Type","text/plain"),t&&(c.onreadystatechange=function(){if(4==c.readyState){var e=c.status;if(200>e||e>=300&&304!=e)throw new Error("Failed communicating to native bridge, status code: "+e)}}),c.send(JSON.stringify({args:e,appId:this.appId})),t?(o=c.responseText,o&&JSON.parse(o)):void 0}}),Ext.define("Ext.Promise",{statics:{when:function(){function e(e){s.reject(e)}function t(c){n=i.shift(),a>=0&&(o[a]=c),a++,n?n.then(t,e):s.fulfill.apply(s,o)}var n,s=new this,i=Array.prototype.slice.call(arguments),a=-1,o=[];return t(),s},whenComplete:function(e){function t(t){i=e.shift(),r.push(t),s(i)}function n(t){i=e.shift(),c.push(t),s(i)}function s(e){o++,e?e.then(n,t):a.fulfill.call(a,{fulfilled:c,rejected:r})}var i,a=new this,o=-1,c=[],r=[];return s(e.shift()),a},from:function(){var e=new this;return e.completed=1,e.lastResults=arguments,e},fail:function(e){var t=new this;return t.completed=-1,t.lastReason=e,t}},completed:0,getListeners:function(e){var t=this.listeners;return!t&&e&&(this.listeners=t=[]),t},then:function(e,t,n){return"function"==typeof e&&(n=t,t=e,e=null),"string"==typeof t&&(t=e[t]),"string"==typeof n&&(n=e[n]),this.doThen(e,t,n)},doThen:function(e,t,n){var s,i,a=Ext.Promise,o=this.completed;if(-1===o)return n&&n.call(e,this.lastReason),this;if(1!==o||this.isFulfilling)s=new a,s.$owner=this,this.getListeners(!0).push({scope:e,success:t,error:n,promise:s});else{if(!t)return this;i=t.apply(e,this.lastResults),s=i instanceof a?i:a.from(i)}return s},error:function(e,t){return"function"==typeof e&&(t=e,e=null),"string"==typeof t&&(t=e[t]),this.doThen(e,null,t)},fulfill:function(){var e,t,n,s,i,a,o=arguments;for(this.lastResults=o,this.completed=1;e=this.getListeners();){for(delete this.listeners,this.isFulfilling=!0;t=e.shift();)s=t.success,s&&(n=t.scope,i=t.promise,delete i.$owner,a=s.apply(n,o),a instanceof Ext.Promise?a.connect(i):i.fulfill(a));this.isFulfilling=!1}return this},connect:function(e){var t=this;t.then(e,function(e){return this.fulfill(e),e},"reject")},reject:function(e){var t,n,s,i=this.getListeners();if(this.lastReason=e,this.completed=-1,i)for(delete this.listeners;t=i.shift();)n=t.error,s=t.promise,delete s.$owner,n&&n.call(t.scope,e),s.reject(e);return this},cancel:function(){var e,t,n,s=this.getListeners(),i=this.$owner;if(s){for(e=0,t=s.length;t>e;e++)n=s[e],n.promise.cancel();s.length=0,delete this.listeners}i&&(delete this.$owner,i.cancel())}}),Ext.define("Ext.space.Observable",{constructor:function(){this.listeners=[]},isWatching:!1,startWatching:function(){},invokeListeners:function(){for(var e,t=this.listeners,n=t.length,s=0;n>s;s++)e=t[s],e[0].apply(e[1],arguments)},addListener:function(){this.isWatching||(this.isWatching=!0,this.startWatching()),this.listeners.push(arguments)}}),Ext.define("Ext.space.Camera",{singleton:!0,source:{library:0,camera:1,album:2},destination:{data:0,file:1},encoding:{jpeg:0,jpg:0,png:1},capture:function(e){var t=this.source,n=this.destination,s=this.encoding,i=e.source,a=e.destination,o=e.encoding;t.hasOwnProperty(i)&&(i=t[i]),n.hasOwnProperty(a)&&(a=n[a]),s.hasOwnProperty(o)&&(o=s[o]),Ext.space.Communicator.send({command:"Camera#capture",callbacks:{success:e.success,failure:e.failure},scope:e.scope,quality:e.quality,width:e.width,height:e.height,source:i,destination:a,encoding:o})}}),Ext.define("Ext.space.Connection",{extend:Ext.space.Observable,singleton:!0,UNKNOWN:"Unknown connection",ETHERNET:"Ethernet connection",WIFI:"WiFi connection",CELL_2G:"Cell 2G connection",CELL_3G:"Cell 3G connection",CELL_4G:"Cell 4G connection",NONE:"No network connection",startWatching:function(){Ext.space.Communicator.send({command:"Connection#watch",callbacks:{callback:this.doConnectionChange},scope:this})},onConnectionChange:function(){this.addListener.apply(this,arguments)},doConnectionChange:function(e){this.invokeListeners(!!e.online,this[e.type])}}),Ext.define("Ext.space.Notification",{singleton:!0,show:function(e){Ext.space.Communicator.send({command:"Notification#show",callbacks:{callback:e.callback},scope:e.scope,title:e.title,message:e.message,buttons:e.buttons.join(",")})},vibrate:function(){Ext.space.Communicator.send({command:"Notification#vibrate"})}}),Ext.define("Ext.space.Orientation",{extend:"Ext.space.Observable",singleton:!0,startWatching:function(){Ext.space.Communicator.send({command:"Orientation#watch",callbacks:{callback:this.doDeviceOrientation},scope:this})},onDeviceOrientation:function(){this.addListener.apply(this,arguments)},doDeviceOrientation:function(e){this.invokeListeners(e)}}),Ext.define("Ext.space.invoke.Connection",{constructor:function(e){this.receiverId=e},send:function(e,t){return Ext.space.Invoke.send(this.receiverId,e,t)},receive:function(){}}),Ext.define("Ext.space.Invoke",{singleton:!0,messageId:0,constructor:function(){var e,t,n,s=this;this.pendingReceivePromises={},this.connections={},this.connectQueue=[],this.messageQueue=[];var i=window.__invokeMessages,a=window.__invokeAppId;if(delete window.__invokeAppId,this.appId=a,!a)throw new Error("window.__invokeAppId is not set properly");if(i&&i.length>0)for(e=0,t=i.length;t>e;e++)n=i[e],this.onReceived(JSON.parse(atob(n)));delete window.__invokeMessages,window.__pushInvokeMessage=function(e){setTimeout(function(){s.onReceived(JSON.parse(atob(e)))},1)}},connect:function(e){var t=this.connections,n=t[e];return n?Ext.Promise.from(n):this.send(e,"__CONNECT__").then(function(){return t[e]=n=new Ext.space.invoke.Connection(e),n})},send:function(e,t,n){var s=this.messageId++,i=new Ext.Promise,a=this.doSend(e,s,t,n),o=this.pendingReceivePromises;return o[s]=i,a.error(function(e){delete o[s],i.reject(e)}),i},onConnect:function(e){var t,n,s,i=this.connectQueue.slice(0);if(this.connectQueue.length=0,e)for(this.connectCallback=e,t=0,n=i.length;n>t;t++)s=i[t],this.onReceived.apply(this,s)},onMessage:function(e){var t,n,s,i=this.messageQueue.slice(0);if(this.messageQueue.length=0,e)for(this.messageCallback=e,t=0,n=i.length;n>t;t++)s=i[t],this.onReceived.apply(this,s)},onAppConnect:function(){return this.connectCallback.apply(this,arguments)},onAppMessage:function(e,t){var n,s=this.connections[e];return s&&(n=s.receive(t)),"undefined"==typeof n&&(n=this.messageCallback.apply(this,arguments)),n},onReceived:function(e){console.warn("ON RECEIVED ",JSON.stringify(e,null,2));var t,n=e.appId,s=e.message,i=e.id,a=e.foreground,o=this.pendingReceivePromises,c=o[i],r=this.connectCallback,l=this.messageCallback;if(delete o[i],c)s.error?c.reject(s.error):c.fulfill(s.success);else try{if("__CONNECT__"===s){if(!r)return this.connectQueue.push(arguments),void 0;t=this.onAppConnect(n)}else{if(!l)return this.messageQueue.push(arguments),void 0;t=this.onAppMessage(n,s)}t instanceof Ext.Promise?t.then(this,function(e){this.doSend(n,i,{success:e},a)},function(e){this.doSend(n,i,{error:e},a)}):this.doSend(n,i,{success:t},a)}catch(u){throw this.doSend(n,i,{error:u},a),u}},broadcast:function(e){var t=new Ext.Promise;return Ext.space.Communicator.send({command:"Invoke#connect",callbacks:{success:function(e){return e&&0!==e.length?(t.fulfill(e),void 0):(t.reject({code:1,message:"There are no receivers for this connection"}),void 0)},failure:function(e){t.reject(e)}},message:e}),t},doSend:function(e,t,n,s){var i=new Ext.Promise,a=function(n){console.warn("RESULT",e,t,n),i.fulfill(n)};return a.args=arguments,console.warn("GOING OUT",e,t,n),Ext.space.Communicator.send({command:"Invoke#send",callbacks:{success:a,failure:function(e){i.reject(e)}},receiverId:e,foreground:s,message:btoa(JSON.stringify({id:t,appId:this.appId,message:n,foreground:s}))}),i}}),Ext.define("Ext.space.sqlite.SQLResultSetRowList",{names:null,rows:null,constructor:function(e){this.names=e.names,this.rows=e.rows},getLength:function(){return this.rows.length},item:function(e){if(e<this.getLength()){var t={},n=this.rows[e];return this.names.forEach(function(e,s){t[e]=n[s]}),t}return null}}),Ext.define("Ext.space.sqlite.SQLResultSet",{insertId:0,rowsAffected:0,rows:null,constructor:function(e){this.insertId=e.insertId,this.rowsAffected=e.rowsAffected,this.rows=new Ext.space.sqlite.SQLResultSetRowList(e)},getInsertId:function(){if(0!=this.insertId)return this.insertId;throw new Error("Ext.space.sqlite.SQLResultSet#getInsertId: An SQLTransaction did not insert a row.")},getRowsAffected:function(){return this.rowsAffected},getRows:function(){return this.rows}}),Ext.define("Ext.space.sqlite.SQLTransaction",{id:0,active:!1,statements:null,constructor:function(e){this.id=e,this.statements=[]},executeSql:function(e){if(!this.active)throw new Error("Ext.space.sqlite.SQLTransaction#executeSql: An attempt was made to use a SQLTransaction that is no longer usable.");if(null==e.sqlStatement)throw new Error("Ext.space.sqlite.SQLTransaction#executeSql: You must specify a `sqlStatement` for the transaction.");this.statements.push({sqlStatement:e.sqlStatement,arguments:e.arguments,callback:e.callback,failure:e.failure,scope:e.scope})}}),Ext.define("Ext.space.sqlite.Database",{id:0,version:null,constructor:function(e,t){this.id=e,this.version=t},getVersion:function(){return Ext.space.Communicator.send({command:"Sqlite#getVersion",sync:!0,databaseId:this.id})},transaction:function(e){if(!e.callback)throw new Error("Ext.space.sqlite.Database#transaction: You must specify a `callback` callback.");var t=this;Ext.space.Communicator.send({command:"Sqlite#createTransaction",databaseId:this.id,readOnly:e.readOnly,callbacks:{success:function(n){var s=null,i=null,a=new Ext.space.sqlite.SQLTransaction(n);if(i=Ext.space.Communicator.send({command:"Sqlite#beginTransaction",sync:!0,transactionId:a.id}),!i&&e.preflight&&(i=e.preflight.call(e.scope||this)),!i)try{a.active=!0,e.callback.call(e.scope||this,a)}catch(o){s=o}finally{a.active=!1}for(var c=a.statements;!s&&!i&&c.length>0;){var r=c.shift(),l=Ext.space.Communicator.send({command:"Sqlite#executeStatement",sync:!0,transactionId:a.id,databaseId:t.id,version:t.version,sqlStatement:r.sqlStatement,arguments:JSON.stringify(r.arguments)});if(l)if(l.error)i=l.error;else if(r.callback){var u=new Ext.space.sqlite.SQLResultSet(l);try{a.active=!0,r.callback.call(r.scope||this,a,u)}catch(o){s=o}finally{a.active=!1}}if(i&&r.failure)try{a.active=!0,r.failure.call(r.scope||this,a,i)||(i=null)}catch(o){s=o}finally{a.active=!1}}if(s||i||(i=Ext.space.Communicator.send({command:"Sqlite#commitTransaction",sync:!0,transactionId:a.id}),i||(e.postflight&&e.postflight.call(e.scope||this),e.success&&e.success.call(e.scope||this))),s||i){if(c.splice(0,c.length),Ext.space.Communicator.send({command:"Sqlite#rollbackTransaction",sync:!0,transactionId:a.id}),s)throw s;e.failure&&e.failure.call(e.scope||this,i)}},failure:function(t){e.failure&&e.failure.call(e.scope||this,t)}},scope:e.scope||this})},readTransaction:function(e){this.transaction(Ext.apply(e,{readOnly:!0}))},changeVersion:function(e){if(null==e.oldVersion)throw new Error("Ext.space.Sqlite#changeVersion: You must specify an `oldVersion` of the database.");if(null==e.newVersion)throw new Error("Ext.space.Sqlite#changeVersion: You must specify a `newVersion` of the database.");this.transaction(Ext.apply(e,{preflight:function(){return e.oldVersion==this.getVersion()?null:"Unable to change version: version mismatch"},postflight:function(){var t=Ext.space.Communicator.send({command:"Sqlite#setVersion",sync:!0,databaseId:this.id,version:e.newVersion});t&&(this.version=e.newVersion)}}))}}),Ext.define("Ext.space.Sqlite",{singleton:!0,openDatabase:function(e){if(null==e.name)throw new Error("Ext.space.Sqlite#openDatabase: You must specify a `name` of the database.");if(null==e.version)throw new Error("Ext.space.Sqlite#openDatabase: You must specify a `version` of the database.");if(null==e.displayName)throw new Error("Ext.space.Sqlite#openDatabase: You must specify a `displayName` of the database.");if(null==e.estimatedSize)throw new Error("Ext.space.Sqlite#openDatabase: You must specify a `estimatedSize` of the database.");var t=null,n=Ext.space.Communicator.send({command:"Sqlite#openDatabase",sync:!0,name:e.name,version:e.version,displayName:e.displayName,estimatedSize:e.estimatedSize,callbacks:{creationCallback:e.creationCallback?function(){e.creationCallback.call(e.scope||this,t)}:null},scope:e.scope||this});if(n){if(n.error)throw new Error(n.error);return t=new Ext.space.sqlite.Database(n.id,n.version)}return null}});